{% extends "layout.html" %}
{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ–∑–µ—Ä–≤–æ–≤{% endblock %}

{% block content %}
<h2 class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ–∑–µ—Ä–≤–æ–≤ –ú–ü–ó</h2>

{% if reserves %}
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <p class="mb-0">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <strong>{{ reserves|length }}</strong></p>
    <div>
      <a href="{{ url_for('export_reserves_excel') }}" class="btn btn-success btn-sm">üì• –°–∫–∞—á–∞—Ç—å Excel</a>
    </div>
  </div>

  <div class="accordion" id="reservesAccordion">
    {% set grouped_reserves = reserves|groupby('calculation_date') %}
    {% for date_group in grouped_reserves %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading{{ loop.index }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse{{ loop.index }}" aria-expanded="false"
                aria-controls="collapse{{ loop.index }}">
          –†–∞—Å—á—ë—Ç –æ—Ç {{ date_group.grouper }} ({{ date_group.list|length }} –ø–æ–∑–∏—Ü–∏–π)
        </button>
      </h2>
      <div id="collapse{{ loop.index }}" class="accordion-collapse collapse"
           aria-labelledby="heading{{ loop.index }}" data-bs-parent="#reservesAccordion">
        <div class="accordion-body p-0">
          <table class="table table-striped mb-0">
            <thead class="table-light">
              <tr>
                <th>‚Ññ</th>
                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                <th>–ú–µ—Ç–æ–¥ —Ä–∞—Å—á—ë—Ç–∞</th>
                <th>–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π —Ä–µ–∑–µ—Ä–≤</th>
              </tr>
            </thead>
            <tbody>
              {% for r in date_group.list %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ r.name or '‚Äî' }}</td>
                <td>{{ r.method_used }}</td>
                <td>{{ "%.2f"|format(r.calculated_reserve) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info text-center">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á—ë—Ç.</div>
{% endif %}
{% endblock %}
